---
title: "1.3.18"
date: 2009-05-10
---
Yan Qiao of [Rocket Fuel Inc](http://www.rocketfuelinc.com/) reported a crash on x86\_64, which was pretty much unexpected !

He nicely offered to help troubleshooting by rebuilding with debugging on and leaving the process running in production to catch the error, then sent me an interesting core 1 week later, which revealed that a field in the struct session which was never touched had been changed due to the sharing of two pools of the same size.

This field should have been initialized but was unfortunately not.

The issue can only happen on x86\_64 with HTTP logging enabled, due to the exact 1024 bytes of the struct session which allows its pool to be shared with the struct requri's.

Thank you guys for your huge help and the risks you have taken leaving that process running!

During a troubleshooting session with the [T20](http://www.iplt20.com/) guys ([Maxim Fedchishin](http://www.cloudadmin.info/), Jason Coward and Viktor Brilon from modX team, Hans from RightScale team), I came across an old leftover process doing nothing after a soft-reload.

That issue is brought once in a while by various people, but it happens too rarely for anyone to get an opportunity to debug it.

The guys accepted that I installed a debugger on their machine to see what the process was doing.

It was deadlocked in free() during the reload.

And that made sense : during a reload, the old process releases as much memory as possible to leave room for the new one.

If the two signals sent by the second one are too close to each other, the second signal is sent while the first one has not completed releasing memory and we can have a recursion in the libc's free(), causing a deadlock.

That has been fixed by implementing asynchronous signal delivery.

Thank you guys for giving me the opportunity to catch that rare event!

Problems aside, a few minor features were merged.

The stats are now more readable, report max session rates and provide full 64-bit counters everywhere.

It is now possible to forward invalid requests or responses without blocking them, but they will still be captured.

The config parser now warns about possibly unwanted ordering of ACLs or reqxxx/rspxxx.

Several wrong printf() format strings have been fixed.

The build process now supports an alternative architecture, and the RPM spec file has been cleaned.

A new balance hdr(header) algorithm has been added to balance depending on a header hash.

A new option enables addition of the destination IP address in the X-Original-To header.

And last but not least, the doc has been massively cleaned up and reorganised.

With [all these fixes](/download/1.3/src/CHANGELOG-1.3.18), I released **[1.3.18](download/1.3/src/)**, as well as 1.3.15.9 and 1.3.14.13 which are probably among the last ones of their respective branches after 12 and 18 months of maintenance.
